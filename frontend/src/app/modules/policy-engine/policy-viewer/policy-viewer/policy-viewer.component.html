<div class="content" [attr.status]="policyInfo?.status">
    <ng-container *ngIf="!isConfirmed">
        <div class="not-exist">
            Before starting work you need to get DID
            <a [routerLink]="['/profile']">here</a>
        </div>
    </ng-container>

    <ng-container *ngIf="isConfirmed && (!policyId || !policy)">
        <div class="not-exist">
            Policy doesn't exist
        </div>
    </ng-container>

    <ng-container *ngIf="isConfirmed && policyId && policy">
        <div *ngIf="isDryRun" class="dry-run-content">
            <div
                    class="dry-run-action-btn"
                    [routerLink]="['/policy-configuration']"
                    [queryParams]="{ policyId }"
                    title="Edit Policy"
            >
                <mat-icon>edit</mat-icon>
                <span>View Config</span>
            </div>

            <div
                    class="dry-run-action-btn"
                    (click)="restartDryRun()"
                    title="Save Policy"
            >
                <mat-icon>restart_alt</mat-icon>
                <span>Restart</span>
            </div>

            <div class="delimiter"></div>

            <div class="dry-run-action-btn" (click)="createVirtualUser()">
                <mat-icon>person_add</mat-icon>
                <span>Create User</span>
            </div>

            <div class="dry-run-group-btn" [matMenuTriggerFor]="menu">
                <mat-icon>group</mat-icon>
                <span>Users</span>
                <div class="expand-group">
                    <mat-icon>arrow_drop_down</mat-icon>
                </div>
            </div>

            <div class="delimiter"></div>

            <div
                    class="dry-run-btn"
                    (click)="onView('policy')"
                    [attr.action]="view === 'policy'"
            >
                Policy View
            </div>
            <div
                    class="dry-run-btn"
                    (click)="onView('transactions')"
                    [attr.action]="view === 'transactions'"
            >
                Transactions
            </div>
            <div
                    class="dry-run-btn"
                    (click)="onView('artifacts')"
                    [attr.action]="view === 'artifacts'"
            >
                Artifacts
            </div>
            <div
                    class="dry-run-btn"
                    (click)="onView('ipfs')"
                    [attr.action]="view === 'ipfs'"
            >
                IPFS
            </div>

            <div class="delimiter"></div>
        </div>

        <div class="policy-header" [attr.policy-status]="policyInfo.status">
            <div>
                <a routerLink="/policy-viewer"
                >
                    <p-button
                            icon="pi pi-arrow-left"
                            label="Back to Manage Policies"
                            [ngClass]="
                            policyInfo.status === 'DRY-RUN' ? 'back-button' : ''
                        "
                            styleClass="p-button-outlined p-button-sm"
                    ></p-button
                    >
                </a>
            </div>
            <div class="policy-info-container" *ngIf="policyInfo">
                <div class="policy-name-container">
                    <span *ngIf="policyInfo && policyInfo.name">{{
                            policyInfo.name
                        }}</span>
                </div>

                <div class="policy-additional-info-container">
                    <span
                            *ngIf="
                            policyInfo && policyInfo.version && innerWidth > 810
                        "
                            class="additional-policy-info-text"
                            [ngClass]="
                            policyInfo.status === 'DRY-RUN'
                                ? 'white-additional-policy-info-text'
                                : ''
                        "
                    >Version: ({{ policyInfo.version }})</span
                    >
                    <span
                            *ngIf="!groups.length && innerWidth > 810"
                            class="additional-policy-info-text"
                            [ngClass]="
                            policyInfo.status === 'DRY-RUN'
                                ? 'white-additional-policy-info-text'
                                : ''
                        "
                    >
                        Role: {{ policyInfo.userRoles.join(", ") }}
                    </span>
                </div>
            </div>
        </div>

        <div
                class="policy-container"
                [attr.policy-status]="policyInfo.status"
                [attr.hidden-container]="view !== 'policy'"
        >
            <progress-tracker
                    *ngIf="steps && steps.length > 0"
                    [steps]="steps"
            ></progress-tracker>
            <div style="width: 100%; overflow-y: scroll;">
                <render-block
                        [block]="policy"
                        [policyId]="policyId"
                        style="width: 100%;"
                ></render-block>

                <div *ngIf="!navigationFooterDisabled" class="progress-footer-container">
                    <div class="progress-footer">
                        <button pButton (click)="onNavigationPrevButton()" type="button" class="button" label="Previous"
                                [disabled]="prevButtonDisabled"></button>
                        <div *ngIf="!nextButtonDisabled">
                            <!-- <button pButton type="button" class="p-button-outlined" label="Save Changes" style="margin-right: 16px;"></button> -->
                            <button pButton (click)="onNavigationNextButton()" type="button" class="p-button"
                                    label="Next"></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div
                class="second-policy-container"
            *ngIf="isDryRun"
            [attr.policy-status]="policyInfo.status"
                [attr.hidden-container]="view === 'policy'"
        >
            <div class="table-container">
                <table
                        mat-table
                        [dataSource]="documents"
                        class="document-table"
                >
                    <ng-container matColumnDef="createDate">
                        <th mat-header-cell *matHeaderCellDef>Create Date</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.createDate }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="type">
                        <th mat-header-cell *matHeaderCellDef>Type</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.__type }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="owner">
                        <th mat-header-cell *matHeaderCellDef>Owner</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.owner }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="size">
                        <th mat-header-cell *matHeaderCellDef>Size</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.document?.size }} Byte
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="url">
                        <th mat-header-cell *matHeaderCellDef>Url</th>
                        <td mat-cell *matCellDef="let element">
                            {{ element.documentURL }}
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="document">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let element">
                            <div
                                    class="btn-settings"
                                    (click)="openDocument(element)"
                                matTooltip="Document"
                                    matTooltipPosition="above"
                                    matTooltipClass="guardian-tooltip"
                            >
                                <svg
                                        width="24"
                                        height="24"
                                        viewBox="0 0 24 24"
                                        fill="none"
                                        xmlns="http://www.w3.org/2000/svg"
                                >
                                    <path
                                            class="icon-color"
                                            fill-rule="evenodd"
                                            clip-rule="evenodd"
                                            d="M7.36842 3C6.06037 3 5 4.09894 5 5.45455V18.5455C5 19.9011 6.06038 21 7.36842 21H17.6316C18.9397 21 20 19.9011 20 18.5455V10.3636C20 10.1466 19.9168 9.93853 19.7688 9.78509L13.453 3.23966C13.3774 3.16136 13.2881 3.10055 13.191 3.05979C13.0978 3.02068 12.9973 3 12.8947 3H7.36842ZM12.1053 4.63636H7.36842C6.9324 4.63636 6.57895 5.00267 6.57895 5.45455V18.5455C6.57895 18.9973 6.93241 19.3636 7.36842 19.3636H17.6316C18.0676 19.3636 18.4211 18.9973 18.4211 18.5455V11.1818H12.8947C12.4587 11.1818 12.1053 10.8155 12.1053 10.3636V4.63636ZM17.3046 9.54548L13.6842 5.79347V9.54548H17.3046Z"
                                            fill="#23252E"
                                    />
                                </svg>
                            </div>
                        </td>
                    </ng-container>
                    <tr
                            mat-header-row
                            *matHeaderRowDef="columns; sticky: true"
                    ></tr>
                    <tr mat-row *matRowDef="let row; columns: columns"></tr>
                </table>
            </div>
            <div class="table-paginator">
                <span>Items per page:</span>
                <p-dropdown
                        [options]="[10, 25, 50, 100]"
                        [(ngModel)]="pageSize"
                        (onChange)="newOnPage()"
                ></p-dropdown>
                <span class="color-grey-6"
                >{{ pageIndex * pageSize + 1 }} â€“
                    {{
                        pageIndex * pageSize + pageSize > documentCount
                            ? documentCount
                            : pageIndex * pageSize + pageSize
                    }}
                    of {{ documentCount }}</span
                >
                <div class="flex">
                    <svg
                            (click)="movePageIndex(-1)"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                                d="M15.2828 5.68906C14.8923 5.29856 14.2591 5.29856 13.8686 5.68906L8.98115 10.5813C8.20075 11.3625 8.20106 12.6283 8.98184 13.4091L13.8722 18.2994C14.2627 18.6899 14.8959 18.6899 15.2864 18.2994C15.677 17.9089 15.677 17.2757 15.2864 16.8852L11.1008 12.6996C10.7103 12.309 10.7103 11.6759 11.1008 11.2854L15.2828 7.10326C15.6733 6.71276 15.6733 6.07956 15.2828 5.68906Z"
                                fill="#848FA9"
                        />
                    </svg>
                    <svg
                            (click)="movePageIndex(+1)"
                            width="24"
                            height="24"
                            viewBox="0 0 24 24"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg"
                    >
                        <path
                                d="M8.6926 5.68907C9.0831 5.29857 9.7163 5.29857 10.1068 5.68907L14.9942 10.5813C15.7746 11.3625 15.7743 12.6283 14.9936 13.4091L10.1032 18.2994C9.7127 18.6899 9.0795 18.6899 8.689 18.2994C8.2984 17.9089 8.2984 17.2757 8.689 16.8852L12.8746 12.6996C13.2651 12.309 13.2651 11.6759 12.8746 11.2854L8.6926 7.10327C8.3021 6.71277 8.3021 6.07957 8.6926 5.68907Z"
                                fill="#848FA9"
                        />
                    </svg>
                </div>
            </div>
        </div>
    </ng-container>
</div>

<mat-menu #menu="matMenu">
    <div
            *ngFor="let item of virtualUsers"
            class="debug-user"
            (click)="setVirtualUser(item)"
            [attr.active]="item.active"
    >
        <div class="debug-user-name">{{ item.username }}</div>
        <div class="debug-user-did">{{ item.hederaAccountId }}</div>
        <div class="debug-user-did">{{ item.did }}</div>
    </div>
</mat-menu>

<mat-menu #group="matMenu">
    <div class="group-header">
        Select Group
    </div>
    <div class="group-container">
        <div
                *ngFor="let item of groups"
                class="user-group"
                (click)="setGroup(item)"
                [attr.active]="item.active"
        >
            <div class="user-group-header">
                <span *ngIf="item.groupLabel">{{ item.groupLabel }}</span>
                <span *ngIf="!item.groupLabel">{{ item.uuid }}</span>
            </div>
            <div class="user-group-value">
                <span>Group: </span><span>{{ item.groupName }}</span>
            </div>
            <div class="user-group-value">
                <span>Role: </span><span>{{ item.role }}</span>
            </div>
        </div>
    </div>
    <div class="user-group user-group-default" (click)="setGroup(null)">
        <div class="user-group-header">
            Default state
        </div>
        <div class="user-group-value">
            <span>Group: </span><span>Not Set</span>
        </div>
        <div class="user-group-value">
            <span>Role: </span><span>Not Set</span>
        </div>
    </div>
</mat-menu>

<ng-template #preloader>
    <div class="preloader-image"></div>
</ng-template>

<div *ngIf="loading" class="loading">
    <div class="preloader-image preloader-image-l-size"></div>
</div>
